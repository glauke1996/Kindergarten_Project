{% extends 'base.html' %}

<body>
{% block content %}
<style>
 .children form{
     margin-left: -48px;
 }
 }
</style>
<main class="bg-white">
    <div class="row">
        <div class="col-md-8 mx-auto mt-5">
            <div class="contact-form">
                <div class="row">
                    <div class="my-auto col-md-9">
                        <h1 class="post-title">{{post.title}}</h1>
                        <p class="pt-1 text-truncate">작성일 : {{post.created|date:"Y. m. j | P"}}</p>
                        <!--{% if post.user == user %}
                            <a href="{% url 'notifications:photos' post.pk %}">
                                <span class="modification-btn">사진 업로드</span>
                            </a>
                        {% endif %}-->
                    </div>
                    <div class="col-md-3">
                        {% include "mixins/user_avatar.html" with user=post.user %}
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="Detail-Container pt-4 col-md-12">
                        <p class="lead">{{post.content|safe}}</p>
                        {% for photo in post.photos.all %}
                            <div>
                                <img class="nagasa3 takasa3" src="{{photo.file.url}}"/>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <!--Review sector-->
            <div class="container rounded-lg min-vh-100">
                <div class="pt-2 pb-5">
                    <h42>댓글    {{post.comments.all.count}}개</h4>
                    <!--Comment Form-->
                    <form class="mx-auto my-5" method="POST">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-2 my-auto">
                                {% if user.avatar %}
                                    <div>
                                        <div class="mx-auto takasa nagasa overflow-hidden">
                                            <img class="rounded-circle h-100 w-100 d-flex justify-content-center border border-5 border-dark" src="{{user.avatar.url}}"/>
                                        </div>
                                    </div>
                                {% else %}
                                    <div>
                                        <div class="mx-auto takasa nagasa overflow-hidden rounded-circle">
                                            <img class="h-100 w-100 d-flex justify-content-center" src="/media/avatars/user4.png"/>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-8">{{form}}</div>
                            <button class="call_to-btn h-25 d-flex my-auto"><span class="main-heading">댓글</span></button>
                        </div>
                    </form>
                </div>
                {% load mptt_tags %}
                <div>
                    {% recursetree post.comments.all %}
                    <div id="{{node.id}}"class="my-2 p-2" style="border: 1px solid grey">
                        <div class="row">
                        <div class="col-md-2 col-sm-1">
                        {% if node.user.avatar %}
                                <div>
                                    <div class="mx-auto takasa nagasa overflow-hidden">
                                        <img class="rounded-circle h-100 w-100 d-flex justify-content-center border border-5 border-dark" src="{{node.user.avatar.url}}"/>
                                    </div>
                                </div>
                            {% else %}
                                <div>
                                    <div class="mx-auto takasa nagasa overflow-hidden rounded-circle">
                                        <img class="h-100 w-100 d-flex justify-content-center" src="/media/avatars/user4.png"/>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        {% if node.level > 1 and user != node.parent.user%}
                        <span class="bg-warning">@{{node.parent.user.username}}</span>
                        {% endif %}
                        <div>{{node.content}}</div>
                        <div>{{node.level}}</div>
                        <div>commented by {{node.user.username}}</div>
                        </hr>
                        <button class="border-0" onclick="myFunction({{node.id}})">reply</button>
                        </div>
                    </div>
                        {% if not node.is_leaf_node and node.level == 0 %}
                        <div class="pl-2 pl-md-5">{{children}}</div>
                        {% endif %}
                        {% if node.level == 1 %}
                        <div>{{children}}</div>
                        {% endif %}

                    {% endrecursetree %}
                </div>
                {% for comment in post.comments.all %}
                    <div class="row my-5 border-bottom rounded" id="{{comment.id}}">
                        <!--comment user profile-->
                        <div class="col-md-2">
                            {% if comment.user.avatar %}
                                <div>
                                    <div class="mx-auto takasa nagasa overflow-hidden">
                                        <img class="rounded-circle h-100 w-100 d-flex justify-content-center border border-5 border-dark" src="{{comment.user.avatar.url}}"/>
                                    </div>
                                </div>
                            {% else %}
                                <div>
                                    <div class="mx-auto takasa nagasa overflow-hidden rounded-circle">
                                        <img class="h-100 w-100 d-flex justify-content-center" src="/media/avatars/user4.png"/>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <!--comment letter box-->
                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-md-auto">
                                    <p class="font-weight-bold overflow-hidden">{{comment.user.username}}</p>
                                </div>
                                <div class="col-md-2">
                                    <p>{{post.created|date:"Y. m. j"}}</p>
                                </div>
                                <div class="col-md-2">
                                    <button class="border-0" onclick="myFunction({{comment.id}})">reply</button>
                                </div>
                            </div>
                            <p class="pb-2 lead">{{comment.content}}</p>
                        </div>
                    </div>
                    <!--<div class="js-reply">
                        <div class="col-md-2 text-right align-self-center"><span class="reply text-black-50">┗</span></div>
                        <form class="col-md-10" action="{% url 'comments:create' post.pk %}" method="POST">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-2 my-auto">
                                    {% if user.avatar %}
                                        <div>
                                            <div class="mx-auto takasa nagasa overflow-hidden">
                                                <img class="rounded-circle h-100 w-100 d-flex justify-content-center border border-5 border-dark" src="{{user.avatar.url}}"/>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div>
                                            <div class="mx-auto takasa nagasa overflow-hidden rounded-circle">
                                                <img class="h-100 w-100 d-flex justify-content-center" src="/media/avatars/user4.png"/>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-8">{{form}}</div>
                                <button class="call_to-btn h-25 d-flex my-auto"><span class="main-heading">댓글</span></button>
                            </div>
                        </form>
                    </div>-->
                    
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
        function myFunction(id){
            if(document.contains(document.getElementById("newForm"))){
                document.getElementById("newForm").remove();
            }
            var a=document.getElementById(id);
            a.insertAdjacentHTML('afterend',
            '<form id="newForm" class="form-insert py-2" method="post"> \
                <div class="d-flex justify-content-between"><h2>Reply:</h2><div><button type="button" class="btn btn-outline-secondary" onclick="formExit()"">Close</button></div></div> \
                <select name="parent" class="d-none" id="id_parentt"> \
                <option value="' + id + '" selected="' + id + '"></option> \
                </select> \
                <label for="id_content">Content:</label> \
                <textarea name="content" cols="40" rows="5" class="form-control" required id="id_content"></textarea> \
                {% csrf_token %} \
                <button type="submit" class="btn btn-primary btn-lg btn-block">Submit</button> \
              </form>');
            
        }
    </script>
</main>
{% endblock %}
</body>